<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur DETECT - Scl√©rodermie</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Beta Modal -->
    <div id="beta-modal" class="modal">
        <div class="modal-content">
            <h2>üß™ Version Beta Test</h2>
            <p style="font-size: 0.75rem; color: #888; margin: 15px 0;">
                Outil con√ßu par Astouati Quentin. <br>
                L'utilisation et l'interpr√©tation des r√©sultats rel√®vent de la responsabilit√© exclusive du m√©decin
                r√©f√©rent.
            </p>
            <p>L'algorithme est bas√© sur l'article princeps : <br>
                <a href="https://ard.bmj.com/content/73/7/1340" target="_blank" class="link-article">Coghlan JG, et al.
                    Ann Rheum Dis 2014;73:1340‚Äì1349</a>.
            </p>
            <div class="modal-actions">
                <button id="close-modal" class="btn-primary">J'ai compris</button>
            </div>
        </div>
    </div>

    <div class="app-container">
        <h1>DETECT <span class="highlight">Online</span></h1>
        <p class="subtitle">Algorithme de d√©pistage de l'HTAP dans la SSc</p>

        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="tab-calculator">üßÆ Calculateur</button>
            <button class="tab-btn" data-tab="tab-simulator">üéì Simulateur Didactique</button>
            <button class="tab-btn" data-tab="tab-nomogram">üìä Source Nomogramme</button>
        </nav>

        <main>
            <!-- TAB 1: CALCULATOR (Existing Tool) -->
            <div id="tab-calculator" class="tab-content active">
                <!-- STEP 1 SECTION -->
                <section id="step1" class="card">
                    <div class="card-header">
                        <h2>√âtape 1 : √âvaluation Clinique</h2>
                    </div>

                    <div class="form-grid">
                        <!-- FVC -->
                        <!-- FVC -->
                        <div class="input-group">
                            <label for="fvc">
                                CVF (% pr√©dit)
                                <!-- Points for FVC/DLCO Combo will show here -->
                            </label>
                            <input type="number" id="fvc" step="0.1" placeholder="Ex: 85" autocomplete="off">
                            <small class="hint">Capacit√© Vitale Forc√©e</small>
                        </div>

                        <!-- DLCO -->
                        <div class="input-group">
                            <label for="dlco">
                                DLCO (% pr√©dit)
                                <span id="pts-fvc_dlco" class="points-badge"></span>
                            </label>
                            <input type="number" id="dlco" step="0.1" placeholder="Ex: 45" autocomplete="off">
                            <small class="hint">Capacit√© de Diffusion</small>
                        </div>

                        <!-- Telangiectasias -->
                        <div class="input-group checkbox-group">
                            <label for="telang">
                                T√©langiectasies (Actuelles/Pass√©es)
                                <span id="pts-telang" class="points-badge"></span>
                            </label>
                            <input type="checkbox" id="telang">
                            <span class="checkmark"></span>
                        </div>

                        <!-- ACA -->
                        <div class="input-group checkbox-group">
                            <label for="aca">
                                Anticorps Anti-Centrom√®re (ACA)
                                <span id="pts-aca" class="points-badge"></span>
                            </label>
                            <input type="checkbox" id="aca">
                            <span class="checkmark"></span>
                        </div>

                        <!-- NT-proBNP -->
                        <div class="input-group">
                            <label for="ntprobnp">
                                NT-proBNP (pg/mL)
                                <span id="pts-ntprobnp" class="points-badge"></span>
                            </label>
                            <input type="number" id="ntprobnp" step="1" placeholder="Ex: 150" autocomplete="off">
                        </div>

                        <!-- Urate -->
                        <div class="input-group">
                            <label for="urate">
                                Acide Urique (Urate)
                                <span id="pts-urate" class="points-badge"></span>
                            </label>
                            <div class="multi-input">
                                <input type="number" id="urate" step="0.1" placeholder="Ex: 5.0" autocomplete="off">
                                <select id="urate_unit">
                                    <option value="mgdl">mg/100mL (mg/dL)</option>
                                    <option value="umol">¬µmol/L</option>
                                </select>
                            </div>
                        </div>

                        <!-- RAD -->
                        <div class="input-group checkbox-group">
                            <label for="rad">
                                D√©viation Axiale Droite (ECG)
                                <span id="pts-rad" class="points-badge"></span>
                            </label>
                            <input type="checkbox" id="rad">
                            <span class="checkmark"></span>
                        </div>
                    </div>

                    <div class="action-area">
                        <button id="calc-step1" class="btn-primary">Calculer √âtape 1</button>
                    </div>

                    <!-- Result Area Step 1 -->
                    <!-- ... -->
                </section>

                <!-- STEP 2 SECTION -->
                <section id="step2" class="card hidden">
                    <div class="card-header">
                        <h2>√âtape 2 : √âchocardiographie</h2>
                    </div>

                    <p class="instruction">Indiqu√© car le score √âtape 1 est positif (Risque √©lev√©).</p>

                    <div class="form-grid">
                        <!-- Right Atrium Area -->
                        <div class="input-group">
                            <label for="ra_area">
                                Surface de l'Oreillette Droite (cm¬≤)
                                <span id="pts-ra_area" class="points-badge"></span>
                            </label>
                            <input type="number" id="ra_area" step="0.1" placeholder="Ex: 16" autocomplete="off">
                        </div>

                        <!-- TR Velocity -->
                        <div class="input-group">
                            <label for="tr_vel">
                                V√©locit√© IT (Tricuspid Regurgitation) (m/s)
                                <span id="pts-tr_vel" class="points-badge"></span>
                            </label>
                            <input type="number" id="tr_vel" step="0.1" placeholder="Ex: 2.8" autocomplete="off">
                        </div>
                    </div>

                    <div class="action-area">
                        <button id="calc-step2" class="btn-primary">Calculer √âtape 2 (Final)</button>
                    </div>

                    <!-- Result Area Step 2 -->
                    <div id="result-step2" class="result-box hidden">
                        <div class="score-bars">
                            <!-- Nomogram Bar -->
                            <div class="bar-container">
                                <div class="bar-label">
                                    <span>Nomogramme (Points)</span>
                                    <span class="bar-value"><span id="s2-points-val">--</span> pts</span>
                                </div>
                                <div class="bar-track">
                                    <div id="s2-points-bar" class="bar-fill"></div>
                                    <div class="cutoff-marker" style="left: 35%" title="Seuil: 35 pts"></div>
                                </div>
                                <div class="bar-legend">Seuil : 35 pts</div>
                            </div>
                        </div>

                        <div class="decision-area">
                            <div class="score-decision" id="s2-decision">--</div>
                            <div class="recommendation-box" id="s2-rec-box" style="margin-top: 25px; display: none;">
                                <strong>Conclusion :</strong>
                                <p id="final-recommendation">--</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TAB 2: PHYSIO-ENGINE SIMULATOR -->
            <div id="tab-simulator" class="tab-content">
                <section class="card simulator-card">
                    <div class="card-header">
                        <h2>Physio-Engine DETECT</h2>
                        <span class="badge-didactic">Moteur Physique</span>
                    </div>

                    <!-- MASTER CONTROL -->
                    <div class="master-control-area">
                        <label for="master-paps" class="master-label">
                            Tension Pari√©tale / PAPs (Pression Pulmonaire)
                            <span class="master-val"><span id="paps-val">25</span> <small>mmHg</small></span>
                        </label>
                        <input type="range" id="master-paps" min="15" max="100" value="25" step="1"
                            class="slider-master">
                        <div class="slider-ticks">
                            <span>Normal (20)</span>
                            <span>HTAP L√©g√®re (40)</span>
                            <span>S√©v√®re (>60)</span>
                        </div>
                    </div>

                    <div class="engine-workspace">
                        <!-- LEFT: VECTOR HEART -->
                        <div class="heart-container" style="padding: 0; overflow: hidden; background: #0b1121;">
                            <div id="heart-3d-container" style="width: 100%; height: 400px; position: relative;">
                                <!-- Canvas will be injected here by Three.js -->
                            </div>
                            <div class="heart-legend"
                                style="position:absolute; bottom:10px; left:10px; color: rgba(255,255,255,0.7); z-index: 10;">
                                Visualisation 3D Temps R√©el
                            </div>
                        </div>

                        <!-- RIGHT: DATA DASHBOARD -->
                        <div class="physio-data">
                            <h3>Variables DETECT Live</h3>

                            <div class="data-card">
                                <span class="data-label">V√©locit√© IT (Jet)</span>
                                <span class="data-value"><span id="phy-tr-vel">--</span> m/s</span>
                                <small>Reflet direct de (PAPs - POD)</small>
                            </div>

                            <div class="data-card">
                                <span class="data-label">Surface OD</span>
                                <span class="data-value"><span id="phy-ra-area">--</span> cm¬≤</span>
                                <small>Dilatation sous pression</small>
                            </div>

                            <div class="data-card">
                                <span class="data-label">NT-proBNP</span>
                                <span class="data-value"><span id="phy-bnp">--</span> pg/mL</span>
                                <small>Marqueur de stress pari√©tal</small>
                            </div>

                            <div class="detect-live-result">
                                <h4>Score DETECT Simul√É¬©</h4>
                                <div class="live-score" id="phy-detect-score">--</div>
                                <div class="live-decision" id="phy-detect-decision">--</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TAB 3: NOMOGRAM SOURCE -->
            <div id="tab-nomogram" class="tab-content">
                <section class="card">
                    <div class="card-header">
                        <h2>Source du Calcul</h2>
                    </div>

                    <div class="nomogram-display">
                        <p>L'algorithme DETECT est bas√© sur le nomogramme valid√© dans l'√©tude princeps.</p>

                        <img src="nomogramme.png" alt="Nomogramme DETECT - Figure 3" class="nomogram-image">

                        <div class="reference-box">
                            <strong>R√©f√©rence :</strong><br>
                            Coghlan JG, Denton CP, Gr√ºnig E, et al. <br>
                            <em>Evidence-based detection of pulmonary arterial hypertension in systemic sclerosis: the
                                DETECT study.</em><br>
                            Ann Rheum Dis 2014;73:1340‚Äì1349.
                        </div>

                        <p style="margin-top:20px; font-size:0.9rem;">
                            <strong>Note :</strong> Ce calculateur en ligne reproduit fid√®lement les points attribu√©s
                            par ce nomogramme pour chaque variable, assurant une concordance parfaite avec la m√©thode
                            papier.
                        </p>
                    </div>
                </section>
            </div>
        </main>

        <footer>
            <p style="font-size: 0.8rem; margin-bottom: 5px;">Outil DETECT Online - Version Beta</p>
            <p style="font-size: 0.75rem; opacity: 0.7;">Conception : Astouati Quentin</p>
            <p style="font-size: 0.7rem; opacity: 0.6; max-width: 600px; margin: 15px auto; line-height: 1.4;">
                Disclaimer : Cet outil est fourni √† titre indicatif. L'exactitude des r√©sultats n'est pas garantie.
                L'engagement et la responsabilit√© clinique incombent exclusivement au m√©decin r√©f√©rent.
            </p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="logic.js"></script>
    <script src="physio3d.js"></script>
    <script src="app.js"></script>
</body>

</html>